(()=>{"use strict";var e={957:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.App=t.StoreContext=void 0;const o=r(997),n=r(689),i=r(218),s=r(547),a=r(606);t.StoreContext=(0,n.createContext)((0,i.createStore)()),t.App=()=>{const{bot:e}=(0,s.useBotContext)(),r=(0,i.createStore)();return(0,n.useEffect)((()=>{e&&r.addBot(e)}),[e,r]),(0,o.jsx)(t.StoreContext.Provider,{value:r,children:(0,o.jsx)(s.Router,{children:(0,o.jsx)(s.Route,{path:"/start",children:(0,o.jsx)(a.StartScreen,{})})})})}},421:function(e,t,r){var o=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.dbAuth=t.db=void 0;const n=r(496);o(r(142)).default.config();const{PGDATABASE:i,PGUSER:s,PGPASSWORD:a,PGHOST:l,PGPORT:c}=process.env;t.db=new n.Sequelize(i,s,a,{host:l,port:Number(c),dialect:"postgres",dialectOptions:{ssl:{rejectUnauthorized:!1}}}),t.dbAuth=async()=>{try{await t.db.authenticate(),await t.db.sync()}catch(e){console.log(e)}}},893:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.User=void 0;const o=r(421),n=r(496);t.User=o.db.define("User",{id:{type:n.DataTypes.INTEGER,primaryKey:!0},is_ordered_paid_key:{type:n.DataTypes.BOOLEAN,defaultValue:!1},is_ordered_key:{type:n.DataTypes.BOOLEAN,defaultValue:!1},email:{type:n.DataTypes.STRING,defaultValue:null},first_name:{type:n.DataTypes.STRING,defaultValue:null},last_name:{type:n.DataTypes.STRING,defaultValue:null},phone_number:{type:n.DataTypes.STRING,defaultValue:null},is_staff:{type:n.DataTypes.INTEGER,defaultValue:0},is_active:{type:n.DataTypes.INTEGER,defaultValue:0},chatID:{type:n.DataTypes.STRING,defaultValue:null},inviteLink:{type:n.DataTypes.STRING,defaultValue:null}},{timestamps:!1})},65:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.setupBotListeners=void 0,t.setupBotListeners=e=>{e.client.on("message",(async t=>{try{const{chat:r,message_id:o,text:n}=t;if("/start"!==n&&await e.client.deleteMessage(t.chat.id,String(t.message_id)),null!=n){const t=await e.client.editMessageText(n,{chat_id:r.id,message_id:o});if("boolean"!=typeof t&&t.text===n)return void console.log("Message content is the same. Skipping edit.")}}catch(e){console.error()}})),e.client.on("polling_error",console.log),e.client.on("error",console.log)}},63:function(e,t,r){var o=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.createInviteLink=void 0;const n=o(r(167)),{TELEGRAM_TOKEN:i,CHANNEL_ID:s}=process.env;t.createInviteLink=async function(){try{const e=await n.default.get(`https://api.telegram.org/bot${i}/createChatInviteLink`,{params:{chat_id:s,member_limit:1},headers:{"Content-Type":"application/json"}});if(200===e.status){const t=e.data;if(t.ok&&t.result.invite_link)return t.result.invite_link;console.error("Failed to create invite link:",t.description)}else console.error("Failed to create invite link:",e.statusText)}catch(e){console.error("Error:",e)}}},29:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.useStore=t.lazyInject=t.provide=t.container=void 0,r(236);const o=r(455),n=r(767),i=r(689),s=new o.Container({autoBindInjectable:!0,defaultScope:"Singleton"});t.container=s;const a={singleton:()=>e=>(0,n.fluentProvide)(e).inSingletonScope().done()(e),transient:()=>e=>(0,n.fluentProvide)(e).inTransientScope().done()(e)};t.provide=a;function l(e){const t=(Reflect.getMetadata("diversify-binding-decorators:provide",Reflect)||[]).filter((t=>t.implementationType===e));if(0===t.length)throw new Error(`Provided identifier isn't registered: ${e.toString()}`);s.load(new o.ContainerModule((e=>{t.forEach((t=>t.constraint(e,t.implementationType)))})))}t.lazyInject=e=>(t,r,o)=>{if(!e)throw new Error(`Incorrect identifier provided: ${e}`);s.isBound(e)||l(e),o?o.initializer=()=>s.get(e):Object.defineProperty(t,r,{get:()=>s.get(e),enumerable:!0})},t.useStore=function(e){return(0,i.useMemo)((()=>(s.isBound(e)||l(e),s.get(e))),[e])}},560:function(e,t,r){var o=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const n=r(997),i=r(266),s=r(547),a=o(r(142)),l=r(957);(0,r(421).dbAuth)(),a.default.config();const{TELEGRAM_TOKEN:c,PORT:d}=process.env;if(console.log("Bot mode: ","production"),!c)throw new Error("Provide TELEGRAM_TOKEN to .env https://core.telegram.org/bots#6-botfather");const u=new i.UrbanBotTelegram({token:c,isPolling:!1});(0,s.render)((0,n.jsx)(s.Root,{isNewMessageEveryRender:!1,bot:u,port:d?Number(d):void 0,children:(0,n.jsx)(l.App,{})}),(()=>console.log("telegram bot has started")))},606:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.StartScreen=void 0;const o=r(997),n=r(944),i=r(547),s=r(689),a=r(957),l=r(63);t.StartScreen=(0,n.observer)((()=>{const{findUser:e,updateUser:t}=(0,s.useContext)(a.StoreContext),[r,n]=(0,s.useState)(void 0);return(0,o.jsx)("strong",{children:"bold"}),(0,i.useContact)((({from:r,phoneNumber:o})=>{e(`+${o}`).then((e=>{e?e.inviteLink?n(`Аутентификация пройдена, добро пожаловать в ATOM Insider. \nВнимание - <a href='${e.inviteLink}'>ссылку</a> можно использовать лишь один раз.`):(0,l.createInviteLink)().then((o=>{t(e.phone_number,o,Number(r.id)).then((()=>{n(`Аутентификация пройдена, добро пожаловать в ATOM Insider. \nВнимание - <a href='${o}'>ссылку</a> можно использовать лишь один раз.`)}))})).catch((e=>{n("Что-то пошло не так, нажмите /start")})):n("Владелец с вашим номером не найден. Если вы являетесь держателем бронирования и не можете попасть в канал, обратитесь в @atom_support_bot и укажите телефон указанный при регистрации, а также адрес электронной почты.")})).catch((e=>{console.error("Error:",e)}))})),r?(0,o.jsx)(i.Text,{parseMode:"HTML",children:r}):(0,o.jsx)(i.ButtonGroup,{parseMode:"HTML",title:"Чтобы пройти аутентификацию и получить одноразовую ссылку-приглашение нажмите <b>далее</b>",isReplyButtons:!0,isResizedKeyboard:!0,children:(0,o.jsx)(i.Button,{style:"PRIMARY",request_contact:!0,children:"далее"})})}))},218:function(e,t,r){var o=this&&this.__decorate||function(e,t,r,o){var n,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,r):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,r,o);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(s=(i<3?n(s):i>3?n(t,r,s):n(t,r))||s);return i>3&&s&&Object.defineProperty(t,r,s),s};Object.defineProperty(t,"__esModule",{value:!0}),t.createStore=t.UserStore=void 0;const n=r(29),i=r(211),s=r(893),a=r(65);let l=class{constructor(){this.updateUser=async(e,t,r)=>{await s.User.update({chatID:r,inviteLink:t},{where:{phone_number:e}})},this.addBot=async e=>{(0,a.setupBotListeners)(e)},(0,i.makeAutoObservable)(this)}async findUser(e){return await s.User.findOne({where:{phone_number:e,is_ordered_paid_key:!0}})}};o([i.action],l.prototype,"findUser",null),o([i.action],l.prototype,"updateUser",void 0),o([i.action],l.prototype,"addBot",void 0),l=o([n.provide.singleton()],l),t.UserStore=l,t.createStore=()=>new l},547:e=>{e.exports=require("@urban-bot/core")},266:e=>{e.exports=require("@urban-bot/telegram")},167:e=>{e.exports=require("axios")},142:e=>{e.exports=require("dotenv")},455:e=>{e.exports=require("inversify")},767:e=>{e.exports=require("inversify-binding-decorators")},211:e=>{e.exports=require("mobx")},944:e=>{e.exports=require("mobx-react-lite")},689:e=>{e.exports=require("react")},997:e=>{e.exports=require("react/jsx-runtime")},236:e=>{e.exports=require("reflect-metadata")},496:e=>{e.exports=require("sequelize")}},t={};!function r(o){var n=t[o];if(void 0!==n)return n.exports;var i=t[o]={exports:{}};return e[o].call(i.exports,i,i.exports,r),i.exports}(560)})();